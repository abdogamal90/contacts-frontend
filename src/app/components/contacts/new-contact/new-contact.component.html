<div class="new-contact-container">
  <div class="form-card">
    <div class="form-header">
      <h2>Create New Contact</h2>
      <p class="subtitle">Add a new contact to your list</p>
    </div>

    <form [formGroup]="contactForm" class="contact-form">
      <div class="form-group">
        <label for="name">
          Full Name <span class="required">*</span>
        </label>
        <input 
          id="name"
          type="text" 
          formControlName="name" 
          placeholder="Enter full name"
          [class.invalid]="contactForm.get('name')?.invalid && contactForm.get('name')?.touched"
        >
        <div class="field-footer">
          <div class="validation-messages">
            <div class="error-text" *ngIf="contactForm.get('name')?.hasError('required') && contactForm.get('name')?.touched">
              Name is required
            </div>
            <div class="error-text" *ngIf="contactForm.get('name')?.hasError('minlength') && contactForm.get('name')?.touched">
              Name must be at least 2 characters
            </div>
            <div class="error-text" *ngIf="contactForm.get('name')?.hasError('maxlength')">
              Name cannot exceed 50 characters
            </div>
          </div>
          <span class="char-count" [class.limit-warning]="(contactForm.get('name')?.value?.length || 0) > 45">
            {{ contactForm.get('name')?.value?.length || 0 }}/50
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="phone">
          Phone Number <span class="required">*</span>
        </label>
        <input 
          id="phone"
          type="tel" 
          formControlName="phone" 
          placeholder="Enter phone number"
          [class.invalid]="contactForm.get('phone')?.invalid && contactForm.get('phone')?.touched"
        >
        <div class="field-footer">
          <div class="validation-messages">
            <div class="error-text" *ngIf="contactForm.get('phone')?.hasError('required') && contactForm.get('phone')?.touched">
              Phone number is required
            </div>
            <div class="error-text" *ngIf="contactForm.get('phone')?.hasError('pattern') && contactForm.get('phone')?.touched">
              Phone must contain only numbers
            </div>
            <div class="error-text" *ngIf="contactForm.get('phone')?.hasError('minlength') && contactForm.get('phone')?.touched">
              Phone must be at least 10 digits
            </div>
            <div class="error-text" *ngIf="contactForm.get('phone')?.hasError('maxlength')">
              Phone cannot exceed 15 digits
            </div>
          </div>
          <span class="char-count" [class.limit-warning]="(contactForm.get('phone')?.value?.length || 0) > 13">
            {{ contactForm.get('phone')?.value?.length || 0 }}/15
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="address">
          Address <span class="required">*</span>
        </label>
        <input 
          id="address"
          type="text" 
          formControlName="address" 
          placeholder="Enter address"
          [class.invalid]="contactForm.get('address')?.invalid && contactForm.get('address')?.touched"
        >
        <div class="field-footer">
          <div class="validation-messages">
            <div class="error-text" *ngIf="contactForm.get('address')?.hasError('required') && contactForm.get('address')?.touched">
              Address is required
            </div>
            <div class="error-text" *ngIf="contactForm.get('address')?.hasError('maxlength')">
              Address cannot exceed 200 characters
            </div>
          </div>
          <span class="char-count" [class.limit-warning]="(contactForm.get('address')?.value?.length || 0) > 180">
            {{ contactForm.get('address')?.value?.length || 0 }}/200
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea 
          id="notes"
          formControlName="notes" 
          placeholder="Add any additional notes (optional)"
          rows="4"
        ></textarea>
        <div class="field-footer">
          <div class="validation-messages">
            <div class="error-text" *ngIf="contactForm.get('notes')?.hasError('maxlength')">
              Notes cannot exceed 500 characters
            </div>
          </div>
          <span class="char-count" [class.limit-warning]="(contactForm.get('notes')?.value?.length || 0) > 480">
            {{ contactForm.get('notes')?.value?.length || 0 }}/500
          </span>
        </div>
      </div>

      <!-- Tags Section -->
      <div class="form-group tags-section">
        <label>
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          Tags <span class="optional">(Optional, max 10)</span>
        </label>
        
        <div class="tag-input-container">
          <input 
            type="text" 
            [(ngModel)]="newTag" 
            [ngModelOptions]="{standalone: true}"
            (keyup.enter)="addTag()"
            placeholder="Type a tag and press Enter"
            maxlength="20"
          >
          <button type="button" class="btn-add-tag" (click)="addTag()">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Add
          </button>
        </div>
        
        <div class="selected-tags" *ngIf="selectedTags.length > 0">
          <div class="tag-chip" *ngFor="let tag of selectedTags">
            <span>{{ tag }}</span>
            <button type="button" class="remove-tag" (click)="removeTag(tag)" aria-label="Remove tag">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
        
        <div class="existing-tags" *ngIf="existingTags.length > 0">
          <p class="suggestion-label">Suggested tags from your contacts:</p>
          <div class="tag-suggestions">
            <button 
              type="button" 
              class="tag-suggestion" 
              *ngFor="let tag of existingTags" 
              [class.active]="selectedTags.includes(tag)"
              (click)="toggleExistingTag(tag)">
              {{ tag }}
            </button>
          </div>
        </div>
        
        <div class="tag-counter" [class.warning]="selectedTags.length >= 10">
          {{ selectedTags.length }}/10 tags
        </div>
      </div>

      <!-- Category Section -->
      <div class="form-group">
        <label for="category">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          Category <span class="optional">(Optional)</span>
        </label>
        <select id="category" formControlName="category">
          <option [ngValue]="null">Select a category</option>
          <option value="personal">👤 Personal</option>
          <option value="work">💼 Work</option>
          <option value="family">👨‍👩‍👧‍👦 Family</option>
          <option value="business">🏢 Business</option>
          <option value="other">📌 Other</option>
        </select>
      </div>

      <!-- Favorite Toggle -->
      <div class="form-group">
        <label class="checkbox-container">
          <input type="checkbox" formControlName="isFavorite">
          <span class="checkbox-custom">
            <svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
            </svg>
          </span>
          <svg class="star-icon" [class.filled]="contactForm.get('isFavorite')?.value" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
          <span class="checkbox-label">Mark as favorite</span>
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" routerLink="/contacts">
          Cancel
        </button>
        <button 
          type="submit" 
          class="btn-primary" 
          (click)="createContact()"
          [disabled]="contactForm.invalid"
        >
          <span>Create Contact</span>
        </button>
      </div>
    </form>
  </div>
</div>
